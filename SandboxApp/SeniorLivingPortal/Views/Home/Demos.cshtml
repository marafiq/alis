@{
    ViewData["Title"] = "ALIS Demos";
}

<div class="row mb-4">
    <div class="col-12">
        <h2 class="mb-0">ALIS Framework Demos</h2>
        <p class="text-muted">Interactive demonstrations of ALIS features with Syncfusion Essential JS 2 controls</p>
    </div>
</div>

<!-- Demo 1: Debounced Search with Syncfusion TextBox -->
<div class="demo-section">
    <h4>1. Debounced Search (Syncfusion TextBox)</h4>
    <p>Type in the search box to see debounced requests in action. ALIS waits 300ms after you stop typing before sending the request.</p>
    
    <div class="row">
        <div class="col-md-8">
            <div class="search-container">
                <input type="text" 
                       id="searchTextBox"
                       class="e-input" 
                       placeholder="Search residents by name or room..."
                       name="query"
                       data-alis-get="/Residents/Search"
                       data-alis-trigger="input delay:300ms"
                       data-alis-target="#search-results"
                       data-alis-collect="self"
                       data-alis-indicator="is-loading, #search-spinner" />
                <span class="spinner" id="search-spinner"></span>
            </div>
        </div>
    </div>
    
    <div id="search-results" class="mt-3">
        <p class="text-muted">Start typing to search...</p>
    </div>
    
    <div class="code-sample mt-3">
        <pre>&lt;input type="text" 
       data-alis-get="/Residents/Search"
       data-alis-trigger="input delay:300ms"
       data-alis-target="#search-results"
       data-alis-collect="self" /&gt;</pre>
    </div>
</div>

<!-- Demo 2: Form Validation with Syncfusion Controls -->
<div class="demo-section">
    <h4>2. Form Validation (Syncfusion Controls + FluentValidation ‚Üí ProblemDetails)</h4>
    <p>Server-side validation using FluentValidation returns RFC 7807 ProblemDetails. ALIS displays errors next to Syncfusion fields.</p>
    
    <form data-alis-post="/Residents/Create"
          data-alis-validate="true"
          data-alis-target="#validation-result"
          data-alis-swap="innerHTML"
          data-alis-on-after="handleSuccess">
        
        <div class="row">
            <div class="col-md-4 mb-3">
                <label class="form-label">First Name</label>
                <input type="text" 
                       id="firstNameInput"
                       name="FirstName"
                       data-val="true"
                       data-val-required="First name is required"
                       data-val-minlength="Minimum 2 characters"
                       data-val-minlength-min="2" />
                <span data-valmsg-for="FirstName" class="field-validation-valid text-danger"></span>
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Last Name</label>
                <input type="text" 
                       id="lastNameInput"
                       name="LastName"
                       data-val="true"
                       data-val-required="Last name is required" />
                <span data-valmsg-for="LastName" class="field-validation-valid text-danger"></span>
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Room Number</label>
                <input type="text" 
                       id="roomNumberInput"
                       name="RoomNumber"
                       data-val="true"
                       data-val-required="Room number is required"
                       data-val-regex="Format: A123 (letter + 3 digits)"
                       data-val-regex-pattern="^[A-Z]\d{3}$" />
                <span data-valmsg-for="RoomNumber" class="field-validation-valid text-danger"></span>
            </div>
        </div>
        
        <button id="submitBtn" type="submit" class="e-btn e-primary">
            Submit (Will Validate)
        </button>
    </form>
    
    <div id="validation-result" class="mt-3"></div>
    
    <div class="code-sample mt-3">
        <pre>&lt;form data-alis-post="/Residents/Create"
      data-alis-validate="true"
      data-alis-on-after="handleSuccess"&gt;
    &lt;input name="FirstName" 
           data-val="true"
           data-val-required="First name is required" /&gt;
    &lt;span data-valmsg-for="FirstName"&gt;&lt;/span&gt;
&lt;/form&gt;</pre>
    </div>
</div>

<!-- Demo 3: Cascading Dropdowns with Syncfusion DropDownList -->
<div class="demo-section">
    <h4>3. Cascading Dropdowns (Syncfusion DropDownList)</h4>
    <p>Select a building to load floors, then select a floor to load wings. Each Syncfusion dropdown triggers an ALIS request.</p>
    
    <div class="row">
        <div class="col-md-4 mb-3">
            <label class="form-label">Building</label>
            <select id="buildingDropdown"
                    name="buildingId"
                    data-alis-get="/Facility/Floors"
                    data-alis-trigger="change"
                    data-alis-target="#floorDropdown"
                    data-alis-collect="self"
                    data-alis-on-after="clearWings, enableFloorDropdown">
            </select>
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Floor</label>
            <select id="floorDropdown"
                    name="floorId"
                    data-alis-get="/Facility/Wings"
                    data-alis-trigger="change"
                    data-alis-target="#wingDropdown"
                    data-alis-collect="self"
                    data-alis-on-after="enableWingDropdown">
            </select>
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Wing</label>
            <select id="wingDropdown" name="wingId">
            </select>
        </div>
    </div>
    
    <div class="code-sample mt-3">
        <pre>&lt;select id="buildingDropdown"
        data-alis-get="/Facility/Floors"
        data-alis-trigger="change"
        data-alis-target="#floorDropdown"
        data-alis-collect="self"&gt;
&lt;/select&gt;</pre>
    </div>
</div>

<!-- Demo 4: Delete with Confirmation -->
<div class="demo-section">
    <h4>4. Delete with Confirmation Modal</h4>
    <p>Click delete to see the custom confirmation modal. ALIS waits for user confirmation before proceeding.</p>
    
    <div class="d-flex gap-2">
        <button id="deleteBtn" 
                class="e-btn e-danger"
                data-alis-delete="/Residents/Delete/999"
                data-alis-confirm="deleteConfirm"
                data-alis-confirm-message="Are you sure you want to delete this resident? This action cannot be undone."
                data-alis-target="#delete-result"
                data-alis-swap="innerHTML">
            üóëÔ∏è Delete Resident
        </button>
        <span id="delete-result" class="align-self-center text-muted">Click to test confirmation</span>
    </div>
    
    <div class="code-sample mt-3">
        <pre>&lt;button data-alis-delete="/Residents/Delete/999"
        data-alis-confirm="deleteConfirm"
        data-alis-confirm-message="Are you sure?"
        data-alis-target="#result"&gt;
    Delete
&lt;/button&gt;</pre>
    </div>
</div>

<!-- Demo 5: Syncfusion Controls with ALIS Validation -->
<div class="demo-section">
    <h4>5. Full Syncfusion Form (DropDownList, NumericTextBox, DatePicker, CheckBox)</h4>
    <p>ALIS includes a Syncfusion adapter that correctly reads values from EJ2 components and applies validation states.</p>
    
    <form id="syncfusionForm"
          data-alis-post="/Vitals/Record"
          data-alis-validate="true"
          data-alis-target="#syncfusion-result"
          data-alis-swap="none"
          data-alis-on-after="handleSuccess">
        
        <div class="row">
            <div class="col-md-3 mb-3">
                <label class="form-label">Resident</label>
                <select id="residentDropdown" 
                        name="ResidentId"
                        data-val="true"
                        data-val-required="Please select a resident">
                </select>
                <span data-valmsg-for="ResidentId" class="field-validation-valid text-danger"></span>
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Systolic BP (mmHg)</label>
                <input id="systolicInput" 
                       name="BloodPressureSystolic"
                       data-val="true"
                       data-val-required="Systolic BP is required"
                       data-val-range="Must be between 60 and 250"
                       data-val-range-min="60"
                       data-val-range-max="250" />
                <span data-valmsg-for="BloodPressureSystolic" class="field-validation-valid text-danger"></span>
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Diastolic BP (mmHg)</label>
                <input id="diastolicInput" 
                       name="BloodPressureDiastolic"
                       data-val="true"
                       data-val-required="Diastolic BP is required"
                       data-val-range="Must be between 40 and 150"
                       data-val-range-min="40"
                       data-val-range-max="150" />
                <span data-valmsg-for="BloodPressureDiastolic" class="field-validation-valid text-danger"></span>
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Heart Rate (bpm)</label>
                <input id="heartRateInput" 
                       name="HeartRate"
                       data-val="true"
                       data-val-required="Heart rate is required"
                       data-val-range="Must be between 30 and 220"
                       data-val-range-min="30"
                       data-val-range-max="220" />
                <span data-valmsg-for="HeartRate" class="field-validation-valid text-danger"></span>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-3 mb-3">
                <label class="form-label">Temperature (¬∞F)</label>
                <input id="temperatureInput" 
                       name="Temperature"
                       data-val="true"
                       data-val-required="Temperature is required"
                       data-val-range="Must be between 95 and 108"
                       data-val-range-min="95"
                       data-val-range-max="108" />
                <span data-valmsg-for="Temperature" class="field-validation-valid text-danger"></span>
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Oxygen Saturation (%)</label>
                <input id="oxygenInput" 
                       name="OxygenSaturation"
                       data-val="true"
                       data-val-required="SpO2 is required"
                       data-val-range="Must be between 70 and 100"
                       data-val-range-min="70"
                       data-val-range-max="100" />
                <span data-valmsg-for="OxygenSaturation" class="field-validation-valid text-danger"></span>
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Recorded Date</label>
                <input id="recordedDate" 
                       name="RecordedAt"
                       data-val="true"
                       data-val-required="Date is required" />
                <span data-valmsg-for="RecordedAt" class="field-validation-valid text-danger"></span>
            </div>
            <div class="col-md-3 mb-3 d-flex align-items-end">
                <div>
                    <input id="urgentCheckbox" 
                           name="IsUrgent"
                           type="checkbox" />
                    <label for="urgentCheckbox" class="ms-2">Mark as Urgent</label>
                </div>
            </div>
        </div>
        
        <button id="recordVitalsBtn" type="submit" class="e-btn e-primary">
            Record Vitals
        </button>
    </form>
    
    <div id="syncfusion-result" class="mt-3"></div>
</div>

<!-- Demo 6: Hyperlink Navigation -->
<div class="demo-section">
    <h4>6. Hyperlink Navigation (Partial Page Updates)</h4>
    <p>Standard links enhanced with ALIS to load content without full page reload.</p>
    
    <div class="d-flex gap-3 mb-3">
        <a href="#"
           data-alis-get="/Residents/Details/1"
           data-alis-target="#resident-details"
           data-alis-indicator="is-loading">
            View Eleanor Thompson
        </a>
        <a href="#"
           data-alis-get="/Residents/Details/2"
           data-alis-target="#resident-details"
           data-alis-indicator="is-loading">
            View Robert Martinez
        </a>
        <a href="#"
           data-alis-get="/Residents/Details/3"
           data-alis-target="#resident-details"
           data-alis-indicator="is-loading">
            View Margaret Chen
        </a>
    </div>
    
    <div id="resident-details" class="border rounded p-3 bg-light">
        <p class="text-muted mb-0">Click a link above to load resident details</p>
    </div>
    
    <div class="code-sample mt-3">
        <pre>&lt;a href="#"
   data-alis-get="/Residents/Details/1"
   data-alis-target="#resident-details"&gt;
    View Resident
&lt;/a&gt;</pre>
    </div>
</div>

@section Scripts {
    <script>
        // Initialize all Syncfusion components for demo
        document.addEventListener('DOMContentLoaded', function() {
            
            // Demo 1: Search TextBox
            new ej.inputs.TextBox({
                placeholder: 'Search residents by name or room...',
                showClearButton: true
            }).appendTo('#searchTextBox');

            // Demo 2: Validation Form TextBoxes
            new ej.inputs.TextBox({
                placeholder: 'Enter first name'
            }).appendTo('#firstNameInput');

            new ej.inputs.TextBox({
                placeholder: 'Enter last name'
            }).appendTo('#lastNameInput');

            new ej.inputs.TextBox({
                placeholder: 'e.g., A123'
            }).appendTo('#roomNumberInput');

            // Demo 3: Cascading Dropdowns
            new ej.dropdowns.DropDownList({
                dataSource: [
                    { text: '-- Select Building --', value: '' },
                    { text: 'Main Building (MAIN)', value: '1' },
                    { text: 'Healthcare Center (HC)', value: '2' },
                    { text: 'Independent Living (IL)', value: '3' }
                ],
                fields: { text: 'text', value: 'value' },
                placeholder: 'Select Building',
                index: 0
            }).appendTo('#buildingDropdown');

            new ej.dropdowns.DropDownList({
                dataSource: [{ text: '-- Select Floor --', value: '' }],
                fields: { text: 'text', value: 'value' },
                placeholder: 'Select Floor',
                enabled: false,
                index: 0
            }).appendTo('#floorDropdown');

            new ej.dropdowns.DropDownList({
                dataSource: [{ text: '-- Select Wing --', value: '' }],
                fields: { text: 'text', value: 'value' },
                placeholder: 'Select Wing',
                enabled: false,
                index: 0
            }).appendTo('#wingDropdown');

            // Demo 4: Delete Button
            new ej.buttons.Button({
                cssClass: 'e-danger',
                iconCss: 'e-icons e-delete'
            }).appendTo('#deleteBtn');

            // Demo 5: Full Syncfusion Form
            new ej.dropdowns.DropDownList({
                dataSource: [
                    { text: 'Eleanor Thompson (A101)', value: 1 },
                    { text: 'Robert Martinez (A102)', value: 2 },
                    { text: 'Margaret Chen (B201)', value: 3 },
                    { text: 'William Johnson (C301)', value: 4 }
                ],
                fields: { text: 'text', value: 'value' },
                placeholder: 'Select a resident'
            }).appendTo('#residentDropdown');

            new ej.inputs.NumericTextBox({
                min: 60,
                max: 250,
                step: 1,
                format: 'n0',
                placeholder: 'Systolic'
            }).appendTo('#systolicInput');

            new ej.inputs.NumericTextBox({
                min: 40,
                max: 150,
                step: 1,
                format: 'n0',
                placeholder: 'Diastolic'
            }).appendTo('#diastolicInput');

            new ej.inputs.NumericTextBox({
                min: 30,
                max: 220,
                step: 1,
                format: 'n0',
                placeholder: 'Heart Rate'
            }).appendTo('#heartRateInput');

            new ej.inputs.NumericTextBox({
                min: 95,
                max: 108,
                step: 0.1,
                format: 'n1',
                placeholder: 'Temperature'
            }).appendTo('#temperatureInput');

            new ej.inputs.NumericTextBox({
                min: 70,
                max: 100,
                step: 1,
                format: 'n0',
                placeholder: 'SpO2'
            }).appendTo('#oxygenInput');

            new ej.calendars.DatePicker({
                value: new Date(),
                format: 'MM/dd/yyyy',
                placeholder: 'Select date'
            }).appendTo('#recordedDate');

            new ej.buttons.CheckBox({
                label: 'Mark as Urgent',
                cssClass: 'e-warning'
            }).appendTo('#urgentCheckbox');

            // Submit buttons
            new ej.buttons.Button({
                cssClass: 'e-primary',
                isPrimary: true
            }).appendTo('#submitBtn');

            new ej.buttons.Button({
                cssClass: 'e-primary',
                isPrimary: true
            }).appendTo('#recordVitalsBtn');
        });

        // Hooks for cascading dropdowns
        window.enableFloorDropdown = function() {
            const floorDropdown = document.getElementById('floorDropdown');
            if (floorDropdown && floorDropdown.ej2_instances && floorDropdown.ej2_instances[0]) {
                floorDropdown.ej2_instances[0].enabled = true;
            }
        };

        window.enableWingDropdown = function() {
            const wingDropdown = document.getElementById('wingDropdown');
            if (wingDropdown && wingDropdown.ej2_instances && wingDropdown.ej2_instances[0]) {
                wingDropdown.ej2_instances[0].enabled = true;
            }
        };
    </script>
}
