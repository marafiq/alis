@model IEnumerable<Resident>
@{
    ViewData["Title"] = "Residents";
}

<div class="row mb-4">
    <div class="col-md-6">
        <h2 class="mb-0">Residents</h2>
        <p class="text-muted">Manage resident information and care details</p>
    </div>
    <div class="col-md-6 text-end">
        <button class="btn btn-primary"
                data-alis-get="/Residents/Create"
                data-alis-target="#modalBody"
                data-alis-on-after="showResidentModal">
            âž• Add Resident
        </button>
    </div>
</div>

<!-- Search and Filters -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-4">
                <div class="search-container">
                    <input type="text" 
                           class="form-control" 
                           placeholder="Search by name or room..."
                           name="query"
                           data-alis-get="/Residents/Search"
                           data-alis-trigger="input delay:300ms"
                           data-alis-target="#residents-list"
                           data-alis-indicator="is-loading, #search-spinner" />
                    <span class="spinner" id="search-spinner"></span>
                </div>
            </div>
            <div class="col-md-3">
                <select class="form-select"
                        name="careLevel"
                        data-alis-get="/Residents/Search"
                        data-alis-trigger="change"
                        data-alis-target="#residents-list"
                        data-alis-collect="closest .card-body">
                    <option value="">All Care Levels</option>
                    <option value="1">Independent Living</option>
                    <option value="2">Assisted Living</option>
                    <option value="3">Memory Care</option>
                    <option value="4">Skilled Nursing</option>
                    <option value="5">Hospice</option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select"
                        name="buildingId"
                        data-alis-get="/Residents/Search"
                        data-alis-trigger="change"
                        data-alis-target="#residents-list"
                        data-alis-collect="closest .card-body">
                    <option value="">All Buildings</option>
                    @foreach (var building in (IEnumerable<DropdownItem>)ViewBag.Buildings)
                    {
                        <option value="@building.Value">@building.Text</option>
                    }
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-outline-secondary w-100"
                        data-alis-get="/Residents/Search"
                        data-alis-target="#residents-list"
                        data-alis-indicator="is-loading">
                    ðŸ”„ Refresh
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Residents List -->
<div id="residents-list">
    @await Html.PartialAsync("_ResidentsList", Model)
</div>

<!-- Modal for Create/Edit -->
<div class="modal fade" id="residentModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Resident</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content loaded via ALIS -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Hooks are already defined in site.js as window functions
        // showResidentModal, closeModal, handleSuccess, refreshResidents are all available
    </script>
}

