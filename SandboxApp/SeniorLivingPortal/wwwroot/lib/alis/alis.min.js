/*! alis-fetch v0.0.1 | MIT */
var ALISBundle=function(e){"use strict";const t=Object.freeze(["get","post","put","patch","delete"]),n=function e(t){const n=t;return Object.getOwnPropertyNames(n).forEach(t=>{const r=n[t];r&&"object"==typeof r&&e(r)}),Object.freeze(t)}({timeout:3e4,credentials:"same-origin",retry:{maxAttempts:3,statusCodes:[408,429,500,502,503,504],baseDelay:1e3,maxDelay:3e4,jitter:.2},duplicateRequest:"ignore",errors:{handlerThrows:"continue",targetNotFound:"warn",collectFails:"abort",duplicateRequest:"ignore"},telemetry:"none"});const r=e=>null!==e&&"object"==typeof e&&!Array.isArray(e);function o(e={},t={}){if(!r(e))throw new TypeError("globalConfig must be an object");if(!r(t))throw new TypeError("elementConfig must be an object");return i(e,t)}function i(e,t){const n={...e};for(const[e,o]of Object.entries(t)){const t=n[e];r(t)&&r(o)?n[e]=i(t,o):Array.isArray(o)?n[e]=[...o]:n[e]=o}return n}function a(e){return e instanceof HTMLFormElement?"submit":e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement?"change":"click"}let s=0;function l(e,t={}){const r=o(n,t.config||{}),i=t.trigger??function(e){if(!e)return"manual";return a(e)}(e);return{version:1,id:t.id||(s+=1,`alis-${Date.now()}-${s}`),element:e,config:r,trigger:i,abortController:new AbortController,state:{attempts:0,aborted:!1,startTime:null,endTime:null,duration:null},request:null,response:null,body:null,validation:null,error:null,collect:null,stateManager:null,success:!1}}const u=Object.freeze({none:0,error:1,warn:2,info:3,debug:4}),c=Object.freeze({error:"error","validate:error":"error","request:timeout":"error","request:abort":"warn","request:retry":"warn","coordinate:duplicate":"warn","validation:display":"warn","hooks:error":"error","hooks:success":"info","swap:start":"info","swap:complete":"info",trigger:"debug",collect:"debug",complete:"info"});function f(e){return function(e){return Object.prototype.hasOwnProperty.call(u,e)}(e)?e:"info"}let d={emit(e,t){const n=function(e){switch(e){case"error":return"error";case"warn":return"warn";case"info":return"info";default:return"debug"}}(t.level);"function"==typeof console[n]&&console[n](`[ALIS:${e}]`,t)}};function m(e,t={},n={}){if("string"!=typeof e||0===e.length)throw new TypeError("eventName must be a non-empty string");const r=n.level??function(e,t={}){return"string"==typeof t[e]?f(t[e]):Object.prototype.hasOwnProperty.call(c,e)?c[e]:e.includes("error")?"error":e.includes("warn")||e.includes("retry")?"warn":"info"}(e,n.levels);if(!function(e="none",t="info"){const n=u[f(e)]??u.none;return n>=(u[f(t)]??u.info)&&n>u.none}("none",r))return!1;const o={event:e,level:r,timestamp:Date.now(),data:t};return d.emit(e,o),o}class p extends Error{constructor(e,t="ALIS_ERROR",n={}){super(e),this.name=this.constructor.name,this.code=t,this.context=n}}class g extends p{constructor(e="Configuration error",t={}){super(e,"CONFIG_ERROR",t)}}const h=new Map;function v(e){if(!e)return{className:"",selector:""};let t="",n="";if(e.includes(",")){const r=e.split(",").map(e=>e.trim());t=r[0]||"",n=r[1]||""}else if(e.includes("@")){const r=e.split("@");t=r[0]||"",n=r[1]||""}else t=e;return{className:t,selector:n}}function y(e,t={}){const n=function(e){return{disabled:(e instanceof HTMLButtonElement||e instanceof HTMLInputElement)&&e.disabled,ariaBusy:e.getAttribute("aria-busy"),classList:Array.from(e.classList),textContent:e instanceof HTMLElement?e.textContent??"":""}}(e),{selector:r}=t.indicator?v(t.indicator):{selector:""};return{apply(){!function(e,t={}){!t.debounced&&(e instanceof HTMLButtonElement||e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement)&&(e.disabled=!0),e.setAttribute("aria-busy","true");const n=e.closest("form");if(n&&n!==e&&n.setAttribute("aria-busy","true"),t.indicator){const{className:n,selector:r}=v(t.indicator);if(n&&e.classList.add(n),r){const e=document.querySelector(r);e&&e.removeAttribute("hidden")}}}(e,t)},restore(){if(function(e,t){if(!t)return;(e instanceof HTMLButtonElement||e instanceof HTMLInputElement)&&(e.disabled=t.disabled),null==t.ariaBusy?e.removeAttribute("aria-busy"):e.setAttribute("aria-busy",t.ariaBusy);const n=e.closest("form");n&&n!==e&&n.removeAttribute("aria-busy"),e.className=t.classList.join(" "),e instanceof HTMLButtonElement&&(e.textContent=t.textContent||"")}(e,n),r){const e=document.querySelector(r);e&&e.setAttribute("hidden","")}}}}function b(e){if(!e||!e.getAttribute)return null;const t=e.getAttribute("name");if(!t||"disabled"in e&&e.disabled)return null;const n=e.getAttribute("data-alis-value");if(n){return{name:t,value:function(e){if(!e)return"";let t=e,n="value";const r=e.lastIndexOf("@");r>0&&(t=e.substring(0,r),n=e.substring(r+1));const o=document.querySelector(t);if(!o)return"";if("value"===n&&"value"in o)return o.value;if("textContent"===n)return o.textContent||"";if("innerHTML"===n)return o.innerHTML||"";if(n.startsWith("data-"))return o.getAttribute(n)||"";return o.getAttribute(n)||""}(n)}}const r=e.getAttribute("data-alis-value-fn");if(r&&"undefined"!=typeof window){const n=window[r];if("function"==typeof n)return{name:t,value:n(e)}}const o=e.ej2_instances;if(Array.isArray(o)&&o.length>0){const e=o[0];if("checked"in e)return e.checked?{name:t,value:"true"}:null;if("value"in e)return{name:t,value:e.value}}if(e instanceof HTMLInputElement)return"checkbox"===e.type?e.checked?{name:t,value:e.value||"on"}:null:"radio"===e.type?e.checked?{name:t,value:e.value}:null:{name:t,value:e.value};if(e instanceof HTMLSelectElement){if(e.multiple){return{name:t,value:Array.from(e.selectedOptions).map(e=>e.value)}}return{name:t,value:e.value}}return e instanceof HTMLTextAreaElement||e instanceof HTMLButtonElement?{name:t,value:e.value}:null}function w(e){if(!(e instanceof HTMLFormElement))throw new TypeError("readFormValues expects a form element");const t={};return Array.from(e.elements).forEach(e=>{const n=b(e);if(!n)return;const{name:r,value:o}=n;void 0===t[r]?t[r]=o:Array.isArray(t[r])?t[r].push(o):t[r]=[t[r],o]}),t}function E(e){if(!(e instanceof Element))throw new TypeError("readContainerValues expects an Element");const t={};return e.querySelectorAll("[name]").forEach(e=>{const n=b(e);n&&(t[n.name]=n.value)}),t}function A(e,t=document){if(!e)throw new Error("resolveElement: target is required");if(e instanceof Element)return e;if("string"==typeof e){const n=t.querySelector(e);if(!n)throw new Error(`Element not found for selector "${e}"`);return n}throw new TypeError("resolveElement: unsupported target type")}function L(e,t={}){const n=function(e,t){if("none"===t)return null;if(t&&t.startsWith("closest:")){const n=t.replace("closest:",""),r=e?.closest(n);if(!r)throw new Error(`collect target "${t}" not found`);return r}if(t&&"self"!==t)return A(t);if("self"===t)return e||null;if(e instanceof HTMLFormElement)return e;if(e&&e.closest){const t=e.closest("form");if(t)return t}return e||null}(e,t.collect);if(!n)return{data:null,source:null};if(n instanceof HTMLFormElement)return{source:n,data:w(n)};if(n===e&&e&&e.getAttribute("name")){const t=b(e);return{source:e,data:t?{[t.name]:t.value}:null}}return{source:n,data:E(n)}}class T{#e;#t;constructor(e,t){this.#e=e,this.#t=t,Object.freeze(this)}get isValid(){return this.#e}get message(){return this.#t}static valid(){return new T(!0,null)}static invalid(e){return new T(!1,e)}static combine(e){const t=e.filter(e=>!e.isValid&&null!==e.message).map(e=>e.message);return{isValid:e.every(e=>e.isValid),messages:t}}}class S{#n=new Map;register(e,t,n={}){if(this.#n.has(e)&&!n.override)throw new Error(`Validator "${e}" is already registered. Use { override: true } to replace.`);this.#n.set(e,t)}get(e){return this.#n.get(e)}has(e){return this.#n.has(e)}keys(){return Array.from(this.#n.keys())}}const M=["e-input-group","e-control-wrapper","e-checkbox-wrapper","e-radio-wrapper"];function x(e){return"true"===e.getAttribute("data-val")&&(!(e instanceof HTMLInputElement&&e.disabled)&&(!(e instanceof HTMLSelectElement&&e.disabled)&&(!(e instanceof HTMLTextAreaElement&&e.disabled)&&("true"===e.getAttribute("data-val-always")||(e instanceof HTMLInputElement&&"hidden"===e.type?function(e){let t=e.parentElement;for(;t;){if(M.some(e=>t?.classList.contains(e)))return j(t);t=t.parentElement}return!1}(e):j(e))))))}function j(e){if(!(e instanceof HTMLElement))return!0;const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility}function H(e,t){if(!e||!t)return null;const n=e.querySelector(`[name="${t}"]`);if(n)return n;const r=t.toLowerCase(),o=e.querySelectorAll("[name]");for(const e of o){const t=e.getAttribute("name");if(t&&t.toLowerCase()===r)return e}return null}function O(e,t){if(!e||!t)return null;const n=e.querySelector(`[data-valmsg-for="${t}"]`);if(n)return n;const r=t.toLowerCase(),o=e.querySelectorAll("[data-valmsg-for]");for(const e of o){const t=e.getAttribute("data-valmsg-for");if(t&&t.toLowerCase()===r)return e}return null}const k=["e-input-group","e-control-wrapper","e-checkbox-wrapper"];class _{showError(e,t,n){const r=O(e,t);r&&(r.textContent=n,r.classList.remove("field-validation-valid"),r.classList.add("field-validation-error"));const o=H(e,t);o&&(o.setAttribute("aria-invalid","true"),o.classList.remove("input-validation-valid"),o.classList.add("input-validation-error"),this.#r(o))}clearError(e,t){const n=O(e,t);n&&(n.textContent="",n.classList.remove("field-validation-error"),n.classList.add("field-validation-valid"));const r=H(e,t);r&&(r.removeAttribute("aria-invalid"),r.classList.remove("input-validation-error"),r.classList.add("input-validation-valid"),this.#o(r))}clearAllErrors(e){e.querySelectorAll("[data-valmsg-for]").forEach(e=>{e.textContent="",e.classList.remove("field-validation-error"),e.classList.add("field-validation-valid")}),e.querySelectorAll('[aria-invalid="true"]').forEach(e=>{e.removeAttribute("aria-invalid")}),e.querySelectorAll(".input-validation-error").forEach(e=>{e.classList.remove("input-validation-error"),e.classList.add("input-validation-valid")}),e.querySelectorAll(".e-error").forEach(e=>{e.classList.remove("e-error")})}#r(e){const t=this.#i(e);t&&t.classList.add("e-error")}#o(e){const t=this.#i(e);t&&t.classList.remove("e-error")}#i(e){let t=e.parentElement;for(;t;){if(k.some(e=>t?.classList.contains(e)))return t;t=t.parentElement}return null}}const q={name:"default",matches:e=>!0,getValue(e){if(e instanceof HTMLInputElement){if("checkbox"===e.type)return e.checked;if("radio"===e.type){const t=e.form;if(t){const n=t.querySelector(`input[name="${e.name}"]:checked`);return n?n.value:null}return e.checked?e.value:null}return e.value}if(e instanceof HTMLSelectElement){if(e.multiple){const t=[];for(let n=0;n<e.options.length;n++)e.options[n].selected&&t.push(e.options[n].value);return t}return e.value}return e instanceof HTMLTextAreaElement?e.value:null},getVisibleElement:e=>e,getBlurTarget:e=>e};class I{#a=[];constructor(){}register(e){this.#a.push(e)}has(e){return this.#a.some(t=>t.name===e)}getAdapter(e){for(const t of this.#a)if(t.matches(e))return t;return q}}const C=["e-input-group","e-control-wrapper","e-checkbox-wrapper","e-radio-wrapper"],V={name:"syncfusion",matches(e){const t=e.ej2_instances;return Array.isArray(t)&&t.length>0},getValue(e){const t=e.ej2_instances;if(!Array.isArray(t)||0===t.length)return null;const n=t[0];return"checked"in n?n.checked:"value"in n?n.value:null},getVisibleElement(e){let t=e.parentElement;for(;t;){if(C.some(e=>t?.classList.contains(e)))return t;t=t.parentElement}return e},getBlurTarget:e=>V.getVisibleElement(e).querySelector('.e-input, .e-checkbox, .e-radio, input:not([type="hidden"])')||e};const $=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;const R=/^-?\d+(\.\d+)?$/;const F=[Object.freeze({__proto__:null,name:"required",validate:function(e,t,n){const r=t.message||"This field is required.";return null==e||!1===e||"false"===e||"string"==typeof e&&""===e.trim()||Array.isArray(e)&&0===e.length?T.invalid(r):T.valid()}}),Object.freeze({__proto__:null,name:"minlength",validate:function(e,t,n){if(null==e||""===e)return T.valid();const r="number"==typeof t.min?t.min:parseInt(String(t.min),10),o=t.message||`Minimum ${r} characters required.`;return"string"==typeof e&&e.length<r?T.invalid(o):T.valid()}}),Object.freeze({__proto__:null,name:"maxlength",validate:function(e,t,n){if(null==e||""===e)return T.valid();const r="number"==typeof t.max?t.max:parseInt(String(t.max),10),o=t.message||`Maximum ${r} characters allowed.`;return"string"==typeof e&&e.length>r?T.invalid(o):T.valid()}}),Object.freeze({__proto__:null,name:"length",validate:function(e,t,n){if(null==e||""===e)return T.valid();const r="number"==typeof t.min?t.min:parseInt(String(t.min),10),o="number"==typeof t.max?t.max:parseInt(String(t.max),10),i=t.message||`Length must be between ${r} and ${o}.`;return"string"==typeof e&&(e.length<r||e.length>o)?T.invalid(i):T.valid()}}),Object.freeze({__proto__:null,name:"range",validate:function(e,t,n){if(null==e||""===e)return T.valid();const r="number"==typeof t.min?t.min:parseFloat(String(t.min)),o="number"==typeof t.max?t.max:parseFloat(String(t.max)),i=t.message||`Value must be between ${r} and ${o}.`,a="number"==typeof e?e:parseFloat(String(e));return isNaN(a)||a<r||a>o?T.invalid(i):T.valid()}}),Object.freeze({__proto__:null,name:"regex",validate:function(e,t,n){if(null==e||""===e)return T.valid();const r=t.pattern,o=t.message||"Invalid format.";if(!r)return T.valid();try{if(!new RegExp(r).test(String(e)))return T.invalid(o)}catch{return T.invalid(o)}return T.valid()}}),Object.freeze({__proto__:null,name:"email",validate:function(e,t,n){if(null==e||""===e)return T.valid();const r=t.message||"Invalid email address.";return $.test(String(e))?T.valid():T.invalid(r)}}),Object.freeze({__proto__:null,name:"number",validate:function(e,t,n){if(null==e||""===e)return T.valid();const r=t.message||"Must be a valid number.",o=String(e);return R.test(o)?T.valid():T.invalid(r)}}),Object.freeze({__proto__:null,name:"equalto",validate:function(e,t,n){if(null==e||""===e)return T.valid();const r=t.message||"Values must match.";let o=t.other;if(!o)return T.valid();o.startsWith("*.")&&(o=o.substring(2));const i=n.closest("form");if(!i)return T.valid();const a=i.querySelector(`[name="${o}"]`);if(!a)return T.valid();const s=a instanceof HTMLInputElement||a instanceof HTMLSelectElement||a instanceof HTMLTextAreaElement?a.value:null;return String(e)!==String(s)?T.invalid(r):T.valid()}}),Object.freeze({__proto__:null,name:"url",validate:function(e,t,n){if(null==e||""===e)return T.valid();const r=t.message||"Invalid URL.";try{return new URL(String(e)),T.valid()}catch{return T.invalid(r)}}})];class B{#n=new S;#a=new I;#s=new _;constructor(){for(const e of F)this.#n.register(e.name,e.validate);this.#a.register(V)}validateField(e,t={}){const{showErrors:n=!1,stopOnFirst:r=!0}=t,o=e.getAttribute("name")||"",i=e.closest("form"),a=function(e){if("true"!==e.getAttribute("data-val"))return{enabled:!1,validators:[]};const t=new Map,n=e.attributes;for(let e=0;e<n.length;e++){const r=n[e],o=r.name;if(!o.startsWith("data-val-"))continue;const i=o.substring(9),a=i.indexOf("-");if(-1===a){const e=i;if(t.has(e)){const n=t.get(e);n&&(n.message=r.value)}else t.set(e,{name:e,message:r.value,params:{}})}else{const e=i.substring(0,a),n=i.substring(a+1);t.has(e)||t.set(e,{name:e,message:"",params:{}});const o=t.get(e);o&&(o.params[n]=r.value)}}return{enabled:!0,validators:Array.from(t.values())}}(e);if(!a.enabled)return T.valid();const s=this.#a.getAdapter(e).getValue(e);for(const t of a.validators){const a=this.#n.get(t.name);if(!a)continue;const l=a(s,{message:t.message,...t.params},e);if(!l.isValid&&(n&&i&&this.#s.showError(i,o,l.message||""),r))return l}return n&&i&&this.#s.clearError(i,o),T.valid()}validateForm(e,t={}){const{showErrors:n=!1}=t,r=e.querySelectorAll('[data-val="true"]'),o=[];for(const e of r){if(!x(e))continue;const r=this.validateField(e,{...t,showErrors:n});o.push(r)}return T.combine(o)}registerValidator(e,t){this.#n.register(e,t,{override:!0})}clearErrors(e){this.#s.clearAllErrors(e)}}class z{#l;#u=new WeakSet;#c=new WeakSet;#f=new Map;#d=new Map;#m;constructor(e,t={}){this.#l=e,this.#m=t.debounceMs??0}attach(e){if(this.#f.has(e))return;const t=e=>this.#p(e),n=e=>this.#g(e);e.addEventListener("blur",t,!0),e.addEventListener("input",n,!0),this.#f.set(e,{blur:t,input:n})}detach(e){const t=this.#f.get(e);t&&(e.removeEventListener("blur",t.blur,!0),e.removeEventListener("input",t.input,!0),this.#f.delete(e))}isTouched(e){return this.#u.has(e)}isInvalid(e){return this.#c.has(e)}markAsInvalid(e){this.#c.add(e)}markAsValid(e){this.#c.delete(e)}reset(){this.#u=new WeakSet,this.#c=new WeakSet;for(const e of this.#d.values())clearTimeout(e);this.#d.clear()}#p(e){const t=e.target;t instanceof Element&&this.#h(t)&&(this.#u.add(t),this.#l(t))}#g(e){const t=e.target;if(t instanceof Element&&this.#h(t)&&this.#c.has(t))if(this.#m>0){const e=this.#d.get(t);e&&clearTimeout(e);const n=setTimeout(()=>{this.#d.delete(t),this.#l(t)},this.#m);this.#d.set(t,n)}else this.#l(t)}#h(e){return"true"===e.getAttribute("data-val")}}const D=new B,N=new WeakMap;function W(e){if(!e)throw new TypeError("getMethodAndUrl: element is required");for(const n of t){const t=e.getAttribute(`data-alis-${n}`);if(t)return{method:n,url:t}}if(e instanceof HTMLFormElement){const t=(e.getAttribute("method")||"get").toLowerCase(),n=e.getAttribute("action");if(!n)throw new Error("Form requires an action attribute or data-alis-{method} attribute for ALIS");return{method:t,url:n}}throw new Error("No ALIS method attribute found")}function U({name:e="registry",allowOverride:t=!1}={}){const n=new Map;function r(t){if("string"!=typeof t||""===t.trim())throw new TypeError(`${e}: key must be a non-empty string`)}return Object.freeze({register:function(o,i,a={}){if(r(o),null==i)throw new TypeError(`${e}: value is required for "${o}"`);const s=n.has(o),l=t||Boolean(a.override);if(s&&!l)throw new Error(`${e}: "${o}" already registered`);return n.set(o,i),i},get:function(e){return r(e),n.get(e)},has:function(e){return r(e),n.has(e)},unregister:function(e){return r(e),n.delete(e)},clear:function(){n.clear()},keys:function(){return Array.from(n.keys())},entries:function(){return Array.from(n.entries())}})}const P=U({name:"ALIS.serialize",allowOverride:!0});function G(e){return"string"==typeof e?e:void 0}function J(e){return new Promise(t=>setTimeout(t,e))}P.register("json",function(e){return{body:e?JSON.stringify(e):void 0,contentType:"application/json"}}),P.register("formdata",function(e){const t=new FormData;return e&&"object"==typeof e&&Object.entries(e).forEach(([e,n])=>{n instanceof File||n instanceof Blob?t.append(e,n):Array.isArray(n)?n.forEach(n=>t.append(e,n)):null!=n&&t.append(e,String(n))}),{body:t,contentType:null}}),P.register("urlencoded",function(e){const t=new URLSearchParams;return e&&"object"==typeof e&&Object.entries(e).forEach(([e,n])=>{null!=n&&(Array.isArray(n)?n.forEach(n=>t.append(e,String(n))):t.append(e,String(n)))}),{body:t.toString(),contentType:"application/x-www-form-urlencoded"}});const X=U({name:"ALIS.retry",allowOverride:!0});function K(e="default"){const t=X.get(e);if(!t)throw new Error(`Unknown retry policy "${e}"`);return t}function Q(e){return Boolean(e&&"object"==typeof e&&("title"in e||"detail"in e||"errors"in e))}X.register("default",{maxAttempts:3,statusCodes:[408,429,500,502,503,504],baseDelay:1e3,maxDelay:3e4,jitter:.2,calculateDelay:function(e,{baseDelay:t,maxDelay:n,jitter:r=0}){return function(e,t){if(!t)return e;const n=e*t,r=e-n,o=e+n;return Math.round(Math.random()*(o-r)+r)}(Math.min(t*2**(e-1),n),r)}});const Y=U({name:"ALIS.swap",allowOverride:!0});function Z(e){if(null===e.offsetParent&&"fixed"!==e.style.position)return!1;if("disabled"in e&&e.disabled)return!1;const t=e.getAttribute("tabindex");if(null!==t&&parseInt(t,10)<0)return!1;return["INPUT","SELECT","TEXTAREA","BUTTON","A"].includes(e.tagName)?!("A"===e.tagName&&!e.hasAttribute("href"))||null!==t:null!==t&&parseInt(t,10)>=0||!!e.isContentEditable}Y.register("innerHTML",function(e,t){return e.innerHTML=t,e}),Y.register("outerHTML",function(e,t){const n=e.ownerDocument.createElement("template");n.innerHTML=t.trim();const r=n.content.firstElementChild;if(!r)return e.outerHTML=t,e.nextElementSibling||e;const o=r.cloneNode(!0);return e.replaceWith(o),o}),Y.register("none",function(e){return e});const ee=[function(e){const{config:t}=e;if(!t||"object"!=typeof t)throw new g("Missing configuration",{ctx:e});if(!t.url)throw new g("Missing URL in configuration",{id:e.id});return e},async function(e){const t=e.config.confirm;return"function"!=typeof t||!1===await t(e)&&(e.state.aborted=!0),e},function(e){const t=e.element;if(!t)return e;const n=t,r=e.config.duplicateRequest||"ignore";if(!h.has(n))return h.set(n,{id:e.id,controller:e.abortController}),e;switch(r){case"ignore":default:e.state.aborted=!0;break;case"abort-previous":{const t=h.get(n);t&&t.controller&&t.controller.abort(),h.set(n,{id:e.id,controller:e.abortController})}case"queue":}return e},function(e){const t="string"==typeof e.config.collect?e.config.collect:void 0,n=L(e.element,{collect:t});return e.collect=n,e},function(e){const t=e.config.triggerElement&&e.config.triggerElement instanceof Element?e.config.triggerElement:e.element;if(!t)return e;const n="string"==typeof e.config.indicator?e.config.indicator:void 0,r=!0===e.config.debounced;return e.stateManager=y(t,{indicator:n,debounced:r}),e},function(e){return e.stateManager?.apply(),e},async function(e){if(!e.config.onBefore)return e;m("hooks:before:start",{id:e.id});const t=Array.isArray(e.config.onBefore)?e.config.onBefore:[e.config.onBefore];for(const n of t)if("function"==typeof n){if(!1===await n(e)){e.state.aborted=!0;break}}return m("hooks:before:complete",{id:e.id}),e},function(e){const t=e.element;if(!(t instanceof HTMLFormElement))return e;if("true"!==t.getAttribute("data-alis-validate"))return e;const n=function(e){if(N.has(e))return N.get(e);const t=new z(e=>{D.validateField(e,{showErrors:!0}).isValid?t.markAsValid(e):t.markAsInvalid(e)},{debounceMs:150});return t.attach(e),N.set(e,t),t}(t),r=t.querySelectorAll('[data-val="true"]'),o=[];for(const e of r){D.validateField(e,{showErrors:!0}).isValid?n.markAsValid(e):(n.markAsInvalid(e),o.push(e))}if(o.length>0){const t=o.map(e=>e.getAttribute("name")||"field").join(", ");e.error=new p("Validation failed for: "+t,"VALIDATION_ERROR")}return e},function(e){if(e.error)return e;const t=e.config.url?{method:e.config.method,url:e.config.url}:e.element?W(e.element):null,n=(G(t?.method)||G(e.config.method)||"GET").toUpperCase(),r="string"==typeof t?.url?t.url:"string"==typeof e.config.url?e.config.url:void 0;if(!r)throw new Error("requestBuildStep: URL is required");const o={...e.config.headers||{}};let i,a=r;const s=e.collect?.data;if(s&&"object"==typeof s){const t=s;if("GET"===n){const e=function(e){const t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{null!=n&&(Array.isArray(n)?n.forEach(n=>t.append(e,String(n))):!function(e){return Boolean(e&&"object"==typeof e&&"name"in e&&"value"in e)}(n)?t.append(e,String(n)):t.append(n.name,String(n.value)))}),t.toString()}(t);e&&(a=function(e,t){if(!t)return e;const n=e.includes("?")?"&":"?";return`${e}${n}${t}`}(a,e))}else{const n=e.element instanceof HTMLFormElement?"formdata":"json",r=function(e="json"){const t=P.get(e);if(!t)throw new Error(`Unknown serializer "${e}"`);return t}("string"==typeof e.config.serialize?e.config.serialize:n),a=r(t);i=a.body,a.contentType&&!o["Content-Type"]&&(o["Content-Type"]=a.contentType)}}return e.request={url:a,method:n,headers:o,body:i},e},async function(e){if(e.error)return e;if(!e.request)throw new Error("requestExecuteStep: request not built");const t=e.request,n={method:t.method,headers:t.headers,body:t.body,credentials:e.config.credentials??"same-origin",signal:e.abortController?.signal},r=()=>fetch(t.url,n);e.state.startTime=e.state.startTime??Date.now();const o=function(e){if(!1===e)return null;if("string"==typeof e)return K(e);if(e&&"object"==typeof e)return{...K("default"),...e};return K("default")}(e.config.retry);let i;return o?i=await async function(e,t,n){const r=n.maxAttempts??1,o=n.statusCodes??[];let i;for(let a=1;a<=r;a++){t.state.attempts=a;try{const t=await e();if(!o.includes(t.status))return t;if(a===r)throw new Error(`Request failed with status ${t.status} after ${r} attempts`);i=new Error(`Retryable status ${t.status}`)}catch(e){if(i=e,a===r)break}const s=n.calculateDelay?n.calculateDelay(a,n):0;s>0&&await J(s)}throw i||new Error("Retry attempts exhausted")}(r,e,o):(e.state.attempts=1,i=await r()),e.response=i,e.state.endTime=Date.now(),e.state.duration=e.state.endTime-(e.state.startTime||e.state.endTime),e},async function(e){if(e.error||!e.response)return e;const t=e.response.headers.get("content-type")||"",n=e.response.clone();return t.includes("json")?(e.body=await n.json(),Q(e.body)&&(e.validation=function(e){if(!Q(e))return null;const t={};return e.errors&&"object"==typeof e.errors&&Object.entries(e.errors).forEach(([e,n])=>{Array.isArray(n)?t[e]=n.map(String):null!=n&&(t[e]=[String(n)])}),{title:e.title||"Validation error",detail:e.detail||"",errors:t}}(e.body))):t.includes("text/")?e.body=await n.text():e.body=await n.arrayBuffer(),e},function(e){if(e.error||!e.response)return e.success=!1,e;const t=e.response.status;return t>=200&&t<300?(e.success=!0,m("response:route",{id:e.id,status:"success"}),e):(e.validation?(e.error=new p(e.validation.title||"Validation failed","SERVER_VALIDATION_ERROR"),m("response:route",{id:e.id,status:"validation-error"})):(e.error=new p(`HTTP ${t}: ${e.response.statusText||"Request failed"}`,"HTTP_ERROR"),m("response:route",{id:e.id,status:"error"})),e.success=!1,e)},function(e){const t=function(e){if(!e)return null;if(e instanceof HTMLFormElement)return e;return e.closest("form")}(e.element);return t?(e.error instanceof p&&"VALIDATION_ERROR"===e.error.code||(function(e){e.querySelectorAll("[data-valmsg-for]").forEach(e=>{e.textContent="",e.classList.remove("field-validation-error"),e.classList.add("field-validation-valid")}),e.querySelectorAll('[aria-invalid="true"]').forEach(e=>{e.removeAttribute("aria-invalid")}),e.querySelectorAll(".input-validation-error").forEach(e=>{e.classList.remove("input-validation-error"),e.classList.add("input-validation-valid")})}(t),e.validation&&function(e,t){t?.errors&&Object.entries(t.errors).forEach(([t,n])=>{const r=O(e,t);r&&(r.textContent=n.join(", "),r.classList.remove("field-validation-valid"),r.classList.add("field-validation-error"));const o=H(e,t);o&&(o.setAttribute("aria-invalid","true"),o.classList.remove("input-validation-valid"),o.classList.add("input-validation-error"))})}(t,e.validation)),e):e},function(e){if("string"!=typeof e.config.target||null==e.body)return e;const t=e.config.target.startsWith("#")?e.config.target:`#${e.config.target}`,n=document.querySelector(t);if(!n)return e;const r=document.activeElement,o=r&&r!==document.body&&!n.contains(r);let i=null,a=null;if(o&&(r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement))try{i=r.selectionStart,a=r.selectionEnd}catch{}const s=function(e="innerHTML"){const t=Y.get(e);if(!t)throw new Error(`Unknown swap strategy "${e}"`);return t}("string"==typeof e.config.swap?e.config.swap:"innerHTML");if(s(n,"string"==typeof e.body?e.body:JSON.stringify(e.body)),o&&r instanceof HTMLElement&&document.body.contains(r)&&(r.focus(),(r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement)&&null!==i&&null!==a))try{r.setSelectionRange(i,a)}catch{}return e},function(e){return e.stateManager?.restore(),e},async function(e){if(!e.config.onAfter)return e;m("hooks:after:start",{id:e.id});const t=Array.isArray(e.config.onAfter)?e.config.onAfter:[e.config.onAfter];for(const n of t)"function"==typeof n&&await n(e);return m("hooks:after:complete",{id:e.id}),e},function(e){if(e.error)return e;const t=e.config?.focus;if(t){const n="string"==typeof t?document.querySelector(t):t;if(n instanceof HTMLElement&&Z(n))return n.focus(),e}const n=e.element;return n instanceof HTMLElement&&Z(n)&&document.body.contains(n)&&document.activeElement!==n&&n.focus(),e},function(e){const t=h.get(e.element);return e.element&&t&&t.id===e.id&&h.delete(e.element),e}];async function te(e){const t=await async function(e,t=[]){let n=e;for(const e of t){if(n.state.aborted){m("pipeline:aborted",{id:n.id});break}try{n=await e(n)}catch(e){n.error=e instanceof Error?e:new Error(String(e)),m("pipeline:error",{id:n.id,error:e})}}return m("pipeline:complete",{id:n.id}),n}(e,ee);if(t.error)throw t.error;return t}const ne=U({name:"ALIS.confirm",allowOverride:!0});async function re(e,t){const n=ne.get(e);if(!n)throw new Error(`Confirm handler "${e}" not found`);return n(t)}function oe(e,t={},n={}){const r=function(e){if(!e)return{};const t=function(e){if(!e)return{};const t={};return Array.from(e.attributes).filter(e=>e.name.startsWith("data-alis-")).forEach(e=>{const n=e.name.replace("data-alis-","");t[n]=e.value}),t}(e),n={};try{const{method:t,url:r}=W(e);n.method=t,n.url=r}catch{}t.target&&(n.target=t.target);t.collect&&(n.collect=t.collect);t.indicator&&(n.indicator=t.indicator);t.swap&&(n.swap=t.swap);t.serialize&&(n.serialize=t.serialize);t.encoding&&(n.encoding=t.encoding);const r=t.concurrency||t["duplicate-request"];r&&(n.duplicateRequest=r);t.retry&&(n.retry=function(e){if("false"===e)return!1;if("true"===e)return!0;try{return JSON.parse(e)}catch{return e}}(t.retry));if(t.confirm){const e=e=>re(t.confirm,e);n.confirm=e}else if(e?.hasAttribute("data-alis-confirm-message")){const t=t=>async function(e,t){const n="string"==typeof e?A(e):e;if(!n)throw new Error("executeElementConfirm: element not found");const r=n.getAttribute("data-alis-confirm");if(r)return re(r,t);const o=n.getAttribute("data-alis-confirm-message")||"Are you sure?";return"function"!=typeof window.confirm||window.confirm(o)}(e,t);n.confirm=t}t.trigger&&(n.trigger=t.trigger);t["on-before"]&&(n.onBefore=ie(t["on-before"]));t["on-after"]&&(n.onAfter=ie(t["on-after"]));return n}(e),o=l(e,{config:{...n,...r,...t}}),i=ae(t);return void 0!==i&&(o.collect={source:e,data:i}),o}function ie(e){return e&&"undefined"!=typeof window?e.split(",").map(e=>e.trim()).filter(Boolean).map(e=>{const t=window[e];return"function"==typeof t?t:(console.warn(`[ALIS] Hook function "${e}" not found on window`),null)}).filter(e=>null!==e):[]}function ae(e){if(e&&Object.prototype.hasOwnProperty.call(e,"data"))return e.data}function se(e){return e&&"string"==typeof e?e.split(",").map(e=>e.trim()).filter(Boolean).map(le):[{selector:null,event:null,delay:0,throttle:0}]}function le(e){const t=e.split(/\s+/);let n=t[0],r=null,o=null,i=0,a=0;if(n.includes("@")){const[e,t]=n.split("@");r=e||null,o=t||null}else o=n;for(let e=1;e<t.length;e++){const n=t[e],r=n.match(/^delay:(\d+)(ms)?$/i),o=n.match(/^throttle:(\d+)(ms)?$/i);r?i=parseInt(r[1],10):o&&(a=parseInt(o[1],10))}return{selector:r,event:o,delay:i,throttle:a}}function ue(e){return!!e.hasAttribute("data-alis")||["get","post","put","patch","delete"].some(t=>e.hasAttribute(`data-alis-${t}`))}function ce(e,t){if(e.hasAttribute("data-alis-trigger"))return function(e,t){const n=se(e.getAttribute("data-alis-trigger")),r=function(e,t){return"keyup"===e&&"key"in t&&"Enter"===t.key?"keyenter":e}(t.type,t);return n.some(e=>{const n=e.event?e.event.split(/\s+/)[0]:null,o=!n||n===r,i=!e.selector||t.target instanceof Element&&t.target.matches(e.selector);return o&&i})}(e,t);const n=a(e);return("keyup"===(r=t.type)?"change":r)===n;var r}const fe=new Map,de=new Map;function me(e=["click","submit","change","input","scroll"],t){e.forEach(e=>{if(fe.has(e))return;const n=e=>{const n=function(e){let t=e.target instanceof Element?e.target:null;for(;t&&t!==document.body;){if(ue(t)){if(ce(t,e))return t;break}t=t.parentElement}return null}(e);if(!n)return;const r=function(e){const t=e.getAttribute("data-alis-trigger");if(!t)return{delay:0,throttle:0};const n=se(t)[0]||{delay:0,throttle:0};return{delay:n.delay||0,throttle:n.throttle||0}}(n);if(r.delay>0)return function(e,t,n){const r=de.get(e)||{timeout:null,lastCall:0};null!==r.timeout&&clearTimeout(r.timeout);r.timeout=window.setTimeout(()=>{r.timeout=null,n()},t),de.set(e,r)}(n,r.delay,()=>{pe(n,e,t,{debounced:!0})}),void(e.cancelable&&e.preventDefault());r.throttle>0&&!function(e,t){const n=de.get(e)||{timeout:null,lastCall:0},r=Date.now();if(r-n.lastCall<t)return!1;return n.lastCall=r,de.set(e,n),!0}(n,r.throttle)||(e.cancelable&&e.preventDefault(),pe(n,e,t,{}))},r="submit"===e;document.addEventListener(e,n,r),fe.set(e,n)})}function pe(e,t,n,r){if("function"==typeof n){const o=function(e){if("undefined"!=typeof SubmitEvent&&e instanceof SubmitEvent&&e.submitter)return e.submitter;return e.target instanceof Element?e.target:null}(t);n(e,t,o,r)}}let ge={};function he(e,t={}){return function(e,t={},n={}){const r=oe(e,t,n),o=ae(t);return void 0!==o&&(r.collect={source:e,data:o}),te(r)}(e,t,ge)}const ve=function(){const e=new B;return{validateField:(t,n={})=>e.validateField(t,n),validateForm:(t,n={})=>e.validateForm(t,n),registerValidator(t,n){e.registerValidator(t,n)},clearErrors(t){e.clearErrors(t)}}}(),ye={version:"0.0.1",init:(e={})=>(ge=be(e),me(void 0,(e,t,n,r)=>{he(e,{triggerElement:n,originEvent:t,debounced:r?.debounced}).catch(e=>{console.error("[ALIS] trigger failed",e)})}),{config:be(ge),initializedAt:Date.now()}),process:()=>0,trigger:he,request:function(e={}){return function(e={},t={}){const n={...t,...e},r=l(e.element instanceof Element?e.element:null,{config:n}),o=ae(e);return void 0!==o&&(r.collect={source:null,data:o}),te(r)}(e,ge)},from:function(e){return function(e,t={}){return{execute(n={}){const r=oe(e,n,t),o=ae(n);return void 0!==o&&(r.collect={source:e,data:o}),te(r)}}}(e,ge)},confirm:{register:function(e,t){return ne.register(e,t,{override:!0})}},validation:ve};function be(e){if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(e=>be(e));const t={};for(const n of Object.keys(e)){const r=e[n];t[n]="function"==typeof r?r:null!==r&&"object"==typeof r?be(r):r}return t}if("undefined"!=typeof window){const e=window;e.ALIS||(e.ALIS=ye)}return e.ALIS=ye,e.default=ye,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=alis.min.js.map
